<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset=utf-8>
<title>Manjaro-JP</title>
<link rel="icon" href="https://manjaro.phoepsilonix.love/favicon.png" type="image/png">
<link rel="stylesheet" type="text/css" href="https://phoepsilonix.love/bl-themes/phoep/css/sport.css?version=3.14.1">
<link rel="stylesheet" type="text/css" href="https://phoepsilonix.love/bl-kernel/css/bootstrap.min.css?version=3.14.1">
<link rel="stylesheet" type="text/css" href="https://phoepsilonix.love/bl-themes/phoep/css/bootstrap.min.css?version=3.14.1">
<!--
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;700;900&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/99398214e6.js" crossorigin="anonymous"></script>
-->
<link rel="stylesheet" href="https://phoepsilonix.love/sunburst.min.css">
<script src="https://phoepsilonix.love/highlight.min.js"></script>
<style>
.main-section {
  display: flex;
  justify-content: space-around;
}
.main-section>.columnLeft,
.main-section>.columnRight {
 width:45vw;
 height:80vh;
 border:1px solid #ddd;
 overflow-y:scroll
}
.source-markdown {
 width:100%;
 height:100%;
 padding:20px;
 border:none
}
.output-htmlarea {
 padding:20px;
 text-align:left
}
</style>
<script type="module">
import init, { pulldown_cmark as wasm } from './wasm-markdown/wasm_markdown.js';

var markdown_file = './README.ja.md';

window.onload=function() {
init()
.then(() => {
    	fetch(markdown_file)
       	.then(response => response.text())
        .then(data => {
        let text = document.createTextNode(data);
        let source = document.getElementById("source-markdown");
        source.value=text.data;
        md2html(text.data);
        });
});

let md = document.getElementById( "source-markdown" );
md.addEventListener('input', () => {
    md2html(md.value);
});
};

function md2html(data) {
        let output = document.getElementById("output-html");
        let text = document.createTextNode(wasm(data));
        output.innerHTML = text.data;
        hljs.highlightAll();
        addCopybtn();
}

function addCopybtn(){
        Array.prototype.forEach.call(document.querySelectorAll('pre > code'), addCopyButton);
}

function addCopyButton(elmCodeFrame){
    var elmSelectButton = document.createElement('div');
    elmSelectButton.setAttribute('class', '__select-code');

    elmSelectButton.setAttribute('style', "\
        display: inline-block;\
        left: 90%;\
        float: right;\
        font-weight: bold;\
        background-color: transparent;\
        cursor: pointer;")

    elmSelectButton.addEventListener('click', function(){
        select(elmCodeFrame);
    });
    elmSelectButton.insertAdjacentHTML('afterbegin', '<span></span><svg width="16" height="16" class="bi bi-clipboard" role="img" fill="currentColor"><use xlink:href="./icon.svg#clipboard"/></svg>');
    elmCodeFrame.insertBefore(elmSelectButton, elmCodeFrame.firstChild);
}

function select(elm){
    var selection = window.getSelection();
    selection.removeAllRanges();
    var range = document.createRange();
    range.selectNodeContents(elm);
    selection.addRange(range);
    document.execCommand('copy');
    selection.removeAllRanges();
    var span = elm.querySelector('.__select-code span');
    span.innerHTML="Copied";
    span.style.transition = 'none';
    setTimeout(function() {
      span.style.opacity = 0;
      span.style.transition = 'opacity 1s';
    }, 500);
    setTimeout(function() {
      span.innerHTML="";
      span.style.opacity =1;
    }, 1000);
}

</script>
</head>
<body>
<header></header>
<section class="main-section">
<div class="columnLeft">
<textarea id="source-markdown" class="source-markdown">
</textarea>
</div>
<div class="columnRight">
<section id="output-html" class="output-htmlarea"></section>
</div>
</section>
<footer></footer>
</body>
</html>
