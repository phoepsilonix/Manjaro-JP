diff --git a/PKGBUILD b/PKGBUILD
index 872e66e..3d733e1 100644
--- a/PKGBUILD
+++ b/PKGBUILD
@@ -45,12 +45,26 @@ build() {
       M="$srcdir/$_pkgname-$pkgver/src" \
       EXTRA_CFLAGS="-DCONFIG_R8168_NAPI -DCONFIG_R8168_VLAN -DCONFIG_ASPM -DENABLE_S5WOL -DENABLE_EEE" \
       modules
+    /usr/lib/modules/${_kernver}/build/scripts/sign-file sha512 /var/lib/dkms/signing_key-${_kernver}.pem /var/lib/dkms/signing_key-${_kernver}.x509 src/${_pkgname}.ko
 }
 
 package() {
     cd "$_pkgname-$pkgver/src"
     install -D -m644 $_pkgname.ko "$pkgdir/usr/lib/modules/$_extramodules/$_pkgname.ko"
 
+    _kernver="$(cat /usr/lib/modules/$_extramodules/version || true)"
+    COMPRESS=$(grep -o "CONFIG_MODULE_COMPRESS_.* 1" /usr/lib/modules/$_kernver/build/include/generated/autoconf.h)
+    COMPRESS=${COMPRESS#CONFIG_MODULE_COMPRESS_}
+    COMPRESS=${COMPRESS% 1}
+    case $COMPRESS in
+    ZSTD)
+        COMP_CMD="zstd -T0 -22 --ultra --auto-threads=logical --rm -f"
+        ;;
+    XZ)
+        COMP_CMD="xz -T0 -f -q -9 --lzma2=dict=2MiB"
+        ;;
+    esac
+    find "${pkgdir}" -name '*.ko' -exec $COMP_CMD {} +
     # set the kernel we've built for inside the install script
     sed -i -e "s/EXTRAMODULES=.*/EXTRAMODULES=${_extramodules}/g" "${startdir}/${_pkgname}.install"
 
